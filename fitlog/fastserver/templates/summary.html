<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="/table.ico" >
    <link href="/static/css/bootstrap.css" rel="stylesheet" />
    <link href="/static/css/bootstrap-table.css" rel="stylesheet" />
    <link href="/static/css/bootstrap-table-filter-control.css" rel="stylesheet"/>
    <link href="/static/css/table.css" rel="stylesheet"/>

    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/bootstrap.js"></script>
    <script src="/static/js/bootstrap-editable.js"></script>
    <script src="/static/js/bootstrap-table.js"></script>
    <script src="/static/js/bootbox.js"></script>
    <script src="/static/js/bootstrap-table-editable.js"></script>
    <script src="/static/js/jquery.tablednd.js"></script>
    <script src="/static/js/bootstrap-table-reorder-rows.js"></script>

    <script src="/static/js/tableExport.js"></script>
    <script src="/static/js/bootstrap-table-export.js"></script>
    <script src="/static/js/clone.js"></script>
    <script src="/static/js/utils.js"></script>

    <title>Summary</title>
</head>
<body>

    <div>
        <button type="button" class="btn btn-default" data-toggle="modal" data-target="#sortModal_table"
                style="margin-left: 5px;margin-right: 5px" id="consistent_cols">
          <i class="glyphicon glyphicon-th-list"></i> Con. cols.
        </button>
    </div>

    <div class="modal fade" id="sortModal_table" tabindex="-1" role="dialog" aria-labelledby="sortModal_tableLabel"
         aria-hidden="false" style="font-size: 16px;position: absolute">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                    <h4 class="modal-title" id="sortModal_tableLabel">New summary</h4> </div>
                <div class="modal-body">
                    <div class="bootstrap-table">
                        <div class="fixed-table-container">
                            <table id="axis" class="table">
                                <thead>
                                    <tr>
                                        <th>
                                            <div class="th-inner">Axis</div>
                                        </th>
                                        <th>
                                            <div class="th-inner">Based on column</div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Horizontal</td>
                                        <td>
                                            <select class="form-control multi-sort-name" id="vertical-select">
                                                <option value="name" selected="selected">Name</option>
                                                <option value="stargazers_count">Stars</option>
                                                <option value="forks_count">Forks</option>
                                                <option value="description">Description</option>
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Vertical</td>
                                        <td>
                                            <select class="form-control multi-sort-name" id="horizontal-select">
                                                <option value="name" selected="selected">Name</option>
                                                <option value="stargazers_count">Stars</option>
                                                <option value="forks_count">Forks</option>
                                                <option value="description">Description</option>
                                            </select>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <hr style="border-width:3px;border-top-color:#888181"> <!--选择要进行的操作-->
                        <div class="fixed-table-container">
                            <table id="method" class="table">
                                <thead>
                                    <tr>
                                        <th>
                                            <div class="th-inner">Method</div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <select class="form-control multi-sort-name" id="method-select">
                                                <option disabled selected value> -- select an method -- </option>
                                                <option value="avg">Avg.</option>
                                                <option value="max">Max.</option>
                                                <option value="min">Min.</option>
                                            </select>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <hr style="border-width:3px;border-top-color:#888181"> <!--选择以谁为准-->
                        <div class="fixed-table-toolbar">
                            <div class="bars">
                                <div id="criterion_toolbar">
                                    <button id="add_criterion" type="button" class="btn btn-default"><i class="glyphicon glyphicon-plus"></i> Add Criterion</button>
                                    <button id="delete_criterion" type="button" class="btn btn-default" disabled="disabled"><i class="glyphicon glyphicon-minus"></i> Delete Criterion</button>
                                </div>
                            </div>
                        </div>
                        <div class="fixed-table-container">
                            <table id="criterion_entry" class="table">
                                <thead>
                                    <tr>
                                        <th>
                                            <div class="th-inner">Criterion Columns</div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <select class="form-control multi-sort-name" id="criterion_entry-select-1">
                                                <option disabled selected value> -- select an column -- </option>
                                                <option value="name">Name</option>
                                                <option value="stargazers_count">Stars</option>
                                                <option value="forks_count">Forks</option>
                                                <option value="description">Description</option>
                                            </select>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                       <hr style="border-width:3px;border-top-color:#888181"> <!--要显示的结果-->
                        <div class="fixed-table-toolbar">
                            <div class="bars">
                                <div id="result_toolbar">
                                    <button id="add_result" type="button" class="btn btn-default"><i class="glyphicon glyphicon-plus"></i> Add Result</button>
                                    <button id="delete_result" type="button" class="btn btn-default" disabled="disabled"><i class="glyphicon glyphicon-minus"></i> Delete Result</button>
                                </div>
                            </div>
                        </div>
                        <div class="fixed-table-container">
                            <table id="result_entry" class="table">
                                <thead>
                                    <tr>
                                        <th>
                                            <div class="th-inner">Result columns</div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <select class="form-control multi-sort-name" id="result_entry-select-1"
                                                    onchange="changeResultSelect('result_entry-select-1')">
                                                <option disabled selected value> -- select an column -- </option>
                                                <option value="name">Name</option>
                                                <option value="stars">Stars</option>
                                                <option value="forks_count">Forks</option>
                                                <option value="description">Description</option>
                                            </select>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                       <hr style="border-width:3px;border-top-color:#888181">  <!--将不同的key做映射-->
                        <div class="fixed-table-container">
                            <table id="result_map" class="table">
                                <thead>
                                    <tr>
                                        <th>
                                            <div class="th-inner">Name</div>
                                        </th>
                                        <th>
                                            <div class="th-inner">Mapped name</div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="cancel_summary" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" id="confirm_summary" class="btn btn-primary">Confirm</button>
                </div>
            </div>
        </div>
    </div>


</body>
<script>
    var $add_criterion = $('#add_criterion');
    var $delete_criterion = $('#delete_criterion');
    var $add_result = $('#add_result');
    var $delete_result = $('#delete_result');


    // 给定table对象，返回有多少行。
    function getTableRowNumber($tableEle){
        return $tableEle.find('tbody tr').length
    }

    function add_one_select_row(selections, table_id_str, delete_button){
        // 根据selections给，table_id中加一行，并正确设置delete_button的状态
        var table_tbody_name = '#' + table_id_str + ' tbody';
        var select_id = table_id_str + '-select-' + ($('#' + table_id_str).find('tbody tr').length+1);
        var onchange_fun_str;
        if(table_id_str==='result_entry'){
            onchange_fun_str = " onchange=changeResultSelect('" + select_id + "')"
        }
        $(table_tbody_name).append(generate_one_tr_select_row(selections, select_id, onchange_fun_str));
        delete_button.attr('disabled', false);
    }
    function delete_last_row(table_id_str, delete_button){
        var $table_id = $('#' + table_id_str);
        if($table_id.find('tbody tr').length>1){
            $('#' + table_id_str + ' tr:last').remove();
            if($table_id.find('tbody tr').length===1){
                if(delete_button!==undefined)
                    delete_button.attr('disabled', true);
            }
        }
    }

    // 增加一个criterion
    $add_criterion.click(function () {
        var selections = ['demo1', 'demo2'];
        add_one_select_row(selections, 'criterion_entry', $delete_criterion);
    });

    // 删除最后的一个criterion
    $delete_criterion.click(function () {
        delete_last_row('criterion_entry', $delete_criterion);
    });

    // 增加一个result
    $add_result.click(function () {
        // 需要保证前面的已经勾选
        var numResults = getTableRowNumber($('#result_entry'));
        var selected_index = $('#result_entry tbody tr').eq(numResults-1).find('select').prop('selectedIndex');
        if(selected_index===0){
            bootbox.alert("You have to select the last result before adding a new one.")
        }else{
            var selections = ['demo1', 'demo2'];
            add_one_select_row(selections, 'result_entry', $delete_result);
        }
    });

    // 删除一个result
    $delete_result.click(function () {
        delete_last_row('result_entry', $delete_result);
        // 删除对应的map
        delete_last_row('result_map', undefined);
    });

    function generate_one_tr_select_row(selections, select_id, onchange_fun_str){
        // 给定selections的List，生成没有默认值的一行select. <tr><td><select>xxx</select></td></tr>
        if(selections.length===0)
            return '';
        var select_ele = generate_select(selections, select_id, onchange_fun_str);
        select_ele = '<tr><td>' + select_ele + '</td></tr>';
        return select_ele
    }

    function generate_select(selections, select_id, onchange_fun_str) {
        // 给定selections的List，生成没有默认值的select html, select_id为该select需要使用的id
        if(onchange_fun_str===undefined || onchange_fun_str===''){
            onchange_fun_str = ''
        }
        var html = "<select class='form-control multi-sort-name' id='" + select_id +"' " + onchange_fun_str + ">"  +
            "<option disabled selected value>  -- select an method -- </option>";
        for(var index=0;index<selections.length;index++){
            html += '<option value="' + selections[index] + '">' + selections[index] + '</option>'
        }
        html += '</select>';
        return html;
    }

    // 当result的select发生变化时触发。
    function changeResultSelect(selectId) {
        // selectId, 是哪个select对象在调用
        var value = document.getElementById(selectId).value;
        // 查看该map是否已经存在
        var parts = selectId.split('-');
        var index = parts[parts.length-1];
        //如果index大于当前的数量，说明需要新生成
        var rowNumber = getTableRowNumber($('#result_map'));
        if(rowNumber<index){
            // 插入一个map到result_map
            var html = "<tr>\n" +
                "           <td>" + value + "</td>\n" +
                "           <td><input value=" + value + " /></td>\n" +
                "       </tr>";
            var table_tbody_name = '#result_map tbody';
            $(table_tbody_name).append(html);
        }else{ //说明已经有了对应的map，直接修改即可
            var $mapEle = $('#result_map tbody tr').eq(index-1).find('td');
            $mapEle.eq(0).html(value);
            $mapEle.eq(1).find('input').attr('value', value);
        }
    }

</script>
</html>